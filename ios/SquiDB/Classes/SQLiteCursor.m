//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./build/j2objc/java/SQLiteCursor.java
//

#include "AbstractWindowedCursor.h"
#include "CursorWindow.h"
#include "DatabaseObjectNotClosedException.h"
#include "DatabaseUtils.h"
#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "Logger.h"
#include "SQLiteCursor.h"
#include "SQLiteCursorDriver.h"
#include "SQLiteDatabase.h"
#include "SQLiteQuery.h"
#include "java/lang/Deprecated.h"
#include "java/lang/Exception.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/Throwable.h"
#include "java/lang/annotation/Annotation.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"

@interface SquiDBSQLiteCursor () {
 @public
  NSString *mEditTable_;
  IOSObjectArray *mColumns_;
  SquiDBSQLiteQuery *mQuery_;
  id<SquiDBSQLiteCursorDriver> mDriver_;
  jint mCount_;
  jint mCursorWindowCapacity_;
  id<JavaUtilMap> mColumnNameMap_;
  JavaLangThrowable *mStackTrace_;
}

- (void)fillWindowWithInt:(jint)requiredPos;

@end

J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mEditTable_, NSString *)
J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mColumns_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mQuery_, SquiDBSQLiteQuery *)
J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mDriver_, id<SquiDBSQLiteCursorDriver>)
J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mColumnNameMap_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(SquiDBSQLiteCursor, mStackTrace_, JavaLangThrowable *)

__attribute__((unused)) static void SquiDBSQLiteCursor_fillWindowWithInt_(SquiDBSQLiteCursor *self, jint requiredPos);

__attribute__((unused)) static IOSObjectArray *SquiDBSQLiteCursor__Annotations$0(void);

NSString *SquiDBSQLiteCursor_TAG = @"SQLiteCursor";

@implementation SquiDBSQLiteCursor

+ (NSString *)TAG {
  return SquiDBSQLiteCursor_TAG;
}

+ (jint)NO_COUNT {
  return SquiDBSQLiteCursor_NO_COUNT;
}

- (instancetype)initWithSquiDBSQLiteDatabase:(SquiDBSQLiteDatabase *)db
                withSquiDBSQLiteCursorDriver:(id<SquiDBSQLiteCursorDriver>)driver
                                withNSString:(NSString *)editTable
                       withSquiDBSQLiteQuery:(SquiDBSQLiteQuery *)query {
  SquiDBSQLiteCursor_initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(self, db, driver, editTable, query);
  return self;
}

- (instancetype)initWithSquiDBSQLiteCursorDriver:(id<SquiDBSQLiteCursorDriver>)driver
                                    withNSString:(NSString *)editTable
                           withSquiDBSQLiteQuery:(SquiDBSQLiteQuery *)query {
  SquiDBSQLiteCursor_initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(self, driver, editTable, query);
  return self;
}

- (SquiDBSQLiteDatabase *)getDatabase {
  return [((SquiDBSQLiteQuery *) nil_chk(mQuery_)) getDatabase];
}

- (jboolean)onMoveWithInt:(jint)oldPosition
                  withInt:(jint)newPosition {
  if (mWindow_ == nil || newPosition < [mWindow_ getStartPosition] || newPosition >= ([((SquiDBCursorWindow *) nil_chk(mWindow_)) getStartPosition] + [((SquiDBCursorWindow *) nil_chk(mWindow_)) getNumRows])) {
    SquiDBSQLiteCursor_fillWindowWithInt_(self, newPosition);
  }
  return true;
}

- (jint)getCount {
  if (mCount_ == SquiDBSQLiteCursor_NO_COUNT) {
    SquiDBSQLiteCursor_fillWindowWithInt_(self, 0);
  }
  return mCount_;
}

- (void)fillWindowWithInt:(jint)requiredPos {
  SquiDBSQLiteCursor_fillWindowWithInt_(self, requiredPos);
}

- (jint)getColumnIndexWithNSString:(NSString *)columnName {
  if (mColumnNameMap_ == nil) {
    IOSObjectArray *columns = mColumns_;
    jint columnCount = ((IOSObjectArray *) nil_chk(columns))->size_;
    JavaUtilHashMap *map = new_JavaUtilHashMap_initWithInt_withFloat_(columnCount, 1);
    for (jint i = 0; i < columnCount; i++) {
      (void) [map putWithId:IOSObjectArray_Get(columns, i) withId:JavaLangInteger_valueOfWithInt_(i)];
    }
    mColumnNameMap_ = map;
  }
  jint periodIndex = [((NSString *) nil_chk(columnName)) java_lastIndexOf:'.'];
  if (periodIndex != -1) {
    JavaLangException *e = new_JavaLangException_init();
    SquiDBLogger_eWithNSString_withNSString_withJavaLangThrowable_(SquiDBSQLiteCursor_TAG, JreStrcat("$$", @"requesting column name with table name -- ", columnName), e);
    columnName = [columnName java_substring:periodIndex + 1];
  }
  JavaLangInteger *i = [((id<JavaUtilMap>) nil_chk(mColumnNameMap_)) getWithId:columnName];
  if (i != nil) {
    return [i intValue];
  }
  else {
    return -1;
  }
}

- (IOSObjectArray *)getColumnNames {
  return mColumns_;
}

- (void)deactivate {
  [super deactivate];
  [((id<SquiDBSQLiteCursorDriver>) nil_chk(mDriver_)) cursorDeactivated];
}

- (void)close {
  [super close];
  @synchronized(self) {
    [((SquiDBSQLiteQuery *) nil_chk(mQuery_)) close];
    [((id<SquiDBSQLiteCursorDriver>) nil_chk(mDriver_)) cursorClosed];
  }
}

- (jboolean)requery {
  if ([self isClosed]) {
    return false;
  }
  @synchronized(self) {
    if (![((SquiDBSQLiteDatabase *) nil_chk([((SquiDBSQLiteQuery *) nil_chk(mQuery_)) getDatabase])) isOpen]) {
      return false;
    }
    if (mWindow_ != nil) {
      [mWindow_ clear];
    }
    mPos_ = -1;
    mCount_ = SquiDBSQLiteCursor_NO_COUNT;
    [((id<SquiDBSQLiteCursorDriver>) nil_chk(mDriver_)) cursorRequeriedWithSquiDBICursor:self];
  }
  @try {
    return [super requery];
  }
  @catch (JavaLangIllegalStateException *e) {
    SquiDBLogger_wWithNSString_withNSString_withJavaLangThrowable_(SquiDBSQLiteCursor_TAG, JreStrcat("$$", @"requery() failed ", [e getMessage]), e);
    return false;
  }
}

- (void)setWindowWithSquiDBCursorWindow:(SquiDBCursorWindow *)window {
  [super setWindowWithSquiDBCursorWindow:window];
  mCount_ = SquiDBSQLiteCursor_NO_COUNT;
}

- (void)setSelectionArgumentsWithNSStringArray:(IOSObjectArray *)selectionArgs {
  [((id<SquiDBSQLiteCursorDriver>) nil_chk(mDriver_)) setBindArgumentsWithNSStringArray:selectionArgs];
}

- (void)java_finalize {
  @try {
    if (mWindow_ != nil) {
      if (mStackTrace_ != nil) {
        NSString *sql = [((SquiDBSQLiteQuery *) nil_chk(mQuery_)) getSql];
        jint len = [((NSString *) nil_chk(sql)) java_length];
        SquiDBLogger_eWithNSString_withNSString_withJavaLangThrowable_(SquiDBSQLiteCursor_TAG, JreStrcat("$$$$$$", @"Finalizing a Cursor that has not been deactivated or closed. database = ", [((SquiDBSQLiteDatabase *) nil_chk([mQuery_ getDatabase])) getLabel], @", table = ", mEditTable_, @", query = ", [sql java_substring:0 endIndex:(len > 1000) ? 1000 : len]), mStackTrace_);
      }
      [self close];
    }
  }
  @finally {
    [super java_finalize];
  }
}

- (void)dealloc {
  JreCheckFinalize(self, [SquiDBSQLiteCursor class]);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, 1, -1 },
    { NULL, NULL, 0x1, -1, 2, -1, -1, -1, -1 },
    { NULL, "LSquiDBSQLiteDatabase;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 3, 4, -1, -1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 5, 6, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 7, 8, -1, -1, -1, -1 },
    { NULL, "[LNSString;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 9, 10, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 11, 12, -1, -1, -1, -1 },
    { NULL, "V", 0x4, 13, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithSquiDBSQLiteDatabase:withSquiDBSQLiteCursorDriver:withNSString:withSquiDBSQLiteQuery:);
  methods[1].selector = @selector(initWithSquiDBSQLiteCursorDriver:withNSString:withSquiDBSQLiteQuery:);
  methods[2].selector = @selector(getDatabase);
  methods[3].selector = @selector(onMoveWithInt:withInt:);
  methods[4].selector = @selector(getCount);
  methods[5].selector = @selector(fillWindowWithInt:);
  methods[6].selector = @selector(getColumnIndexWithNSString:);
  methods[7].selector = @selector(getColumnNames);
  methods[8].selector = @selector(deactivate);
  methods[9].selector = @selector(close);
  methods[10].selector = @selector(requery);
  methods[11].selector = @selector(setWindowWithSquiDBCursorWindow:);
  methods[12].selector = @selector(setSelectionArgumentsWithNSStringArray:);
  methods[13].selector = @selector(java_finalize);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "TAG", "LNSString;", .constantValue.asLong = 0, 0x18, -1, 14, -1, -1 },
    { "NO_COUNT", "I", .constantValue.asInt = SquiDBSQLiteCursor_NO_COUNT, 0x18, -1, -1, -1, -1 },
    { "mEditTable_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "mColumns_", "[LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "mQuery_", "LSquiDBSQLiteQuery;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "mDriver_", "LSquiDBSQLiteCursorDriver;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "mCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mCursorWindowCapacity_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mColumnNameMap_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x2, -1, -1, 15, -1 },
    { "mStackTrace_", "LJavaLangThrowable;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LSquiDBSQLiteDatabase;LSquiDBSQLiteCursorDriver;LNSString;LSquiDBSQLiteQuery;", (void *)&SquiDBSQLiteCursor__Annotations$0, "LSquiDBSQLiteCursorDriver;LNSString;LSquiDBSQLiteQuery;", "onMove", "II", "fillWindow", "I", "getColumnIndex", "LNSString;", "setWindow", "LSquiDBCursorWindow;", "setSelectionArguments", "[LNSString;", "finalize", &SquiDBSQLiteCursor_TAG, "Ljava/util/Map<Ljava/lang/String;Ljava/lang/Integer;>;" };
  static const J2ObjcClassInfo _SquiDBSQLiteCursor = { "SQLiteCursor", "com.yahoo.android.sqlite", ptrTable, methods, fields, 7, 0x1, 14, 10, -1, -1, -1, -1, -1 };
  return &_SquiDBSQLiteCursor;
}

@end

void SquiDBSQLiteCursor_initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(SquiDBSQLiteCursor *self, SquiDBSQLiteDatabase *db, id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  SquiDBSQLiteCursor_initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(self, driver, editTable, query);
}

SquiDBSQLiteCursor *new_SquiDBSQLiteCursor_initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(SquiDBSQLiteDatabase *db, id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  J2OBJC_NEW_IMPL(SquiDBSQLiteCursor, initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_, db, driver, editTable, query)
}

SquiDBSQLiteCursor *create_SquiDBSQLiteCursor_initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(SquiDBSQLiteDatabase *db, id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  J2OBJC_CREATE_IMPL(SquiDBSQLiteCursor, initWithSquiDBSQLiteDatabase_withSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_, db, driver, editTable, query)
}

void SquiDBSQLiteCursor_initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(SquiDBSQLiteCursor *self, id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  SquiDBAbstractWindowedCursor_init(self);
  self->mCount_ = SquiDBSQLiteCursor_NO_COUNT;
  if (query == nil) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"query object cannot be null");
  }
  {
    self->mStackTrace_ = [new_SquiDBDatabaseObjectNotClosedException_init() fillInStackTrace];
  }
  self->mDriver_ = driver;
  self->mEditTable_ = editTable;
  self->mColumnNameMap_ = nil;
  self->mQuery_ = query;
  self->mColumns_ = [query getColumnNames];
  self->mRowIdColumnIndex_ = SquiDBDatabaseUtils_findRowIdColumnIndexWithNSStringArray_(self->mColumns_);
}

SquiDBSQLiteCursor *new_SquiDBSQLiteCursor_initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  J2OBJC_NEW_IMPL(SquiDBSQLiteCursor, initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_, driver, editTable, query)
}

SquiDBSQLiteCursor *create_SquiDBSQLiteCursor_initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_(id<SquiDBSQLiteCursorDriver> driver, NSString *editTable, SquiDBSQLiteQuery *query) {
  J2OBJC_CREATE_IMPL(SquiDBSQLiteCursor, initWithSquiDBSQLiteCursorDriver_withNSString_withSquiDBSQLiteQuery_, driver, editTable, query)
}

void SquiDBSQLiteCursor_fillWindowWithInt_(SquiDBSQLiteCursor *self, jint requiredPos) {
  [self clearOrCreateWindowWithNSString:[((SquiDBSQLiteDatabase *) nil_chk([self getDatabase])) getPath]];
  @try {
    if (self->mCount_ == SquiDBSQLiteCursor_NO_COUNT) {
      jint startPos = SquiDBDatabaseUtils_cursorPickFillWindowStartPositionWithInt_withInt_(requiredPos, 0);
      self->mCount_ = [((SquiDBSQLiteQuery *) nil_chk(self->mQuery_)) fillWindowWithSquiDBCursorWindow:self->mWindow_ withInt:startPos withInt:requiredPos withBoolean:true];
      self->mCursorWindowCapacity_ = [((SquiDBCursorWindow *) nil_chk(self->mWindow_)) getNumRows];
      if (SquiDBLogger_isLoggableWithNSString_withSquiDBLogger_Level_(SquiDBSQLiteCursor_TAG, JreLoadEnum(SquiDBLogger_Level, INFO))) {
        SquiDBLogger_iWithNSString_withNSString_(SquiDBSQLiteCursor_TAG, JreStrcat("$I", @"received count(*) from native_fill_window: ", self->mCount_));
      }
    }
    else {
      jint startPos = SquiDBDatabaseUtils_cursorPickFillWindowStartPositionWithInt_withInt_(requiredPos, self->mCursorWindowCapacity_);
      [((SquiDBSQLiteQuery *) nil_chk(self->mQuery_)) fillWindowWithSquiDBCursorWindow:self->mWindow_ withInt:startPos withInt:requiredPos withBoolean:false];
    }
  }
  @catch (JavaLangRuntimeException *ex) {
    [self closeWindow];
    @throw ex;
  }
}

IOSObjectArray *SquiDBSQLiteCursor__Annotations$0() {
  return [IOSObjectArray newArrayWithObjects:(id[]){ create_JavaLangDeprecated() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(SquiDBSQLiteCursor)

J2OBJC_NAME_MAPPING(SquiDBSQLiteCursor, "com.yahoo.android.sqlite", "SquiDB")
